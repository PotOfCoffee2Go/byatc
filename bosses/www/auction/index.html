<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Onyx and Breezy Auction</title>

  <script>
    /* global localStorage */
    var token = localStorage.getItem('BYATEC_TOKEN');
    if (!token) {
      window.location.href = "/auction/login.html";
    }
  </script>

  <!-- Bootstrap Core CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" rel="stylesheet" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <!-- Custom CSS -->
  <link href="index.css" rel="stylesheet">

  <style type="text/css">
    .panel-primary>.panel-heading {
      background-image: linear-gradient(to bottom, #5bc0de 0, #95d6e9 100%);
    }
    
    .carousel-control.right {
      background-image: linear-gradient(to right, rgba(39, 155, 190, .0001) 0, rgba(39, 155, 190, .5) 100%);
    }
    
    .carousel-control.left {
      background-image: linear-gradient(to right, rgba(39, 155, 190, .5) 0, rgba(39, 155, 190, .0001) 100%);
    }
    
    .tl-checkbox {
      padding: 0 0 0 0;
    }
    
    #tl-item-count,
    #tl-item-status1,
    #tl-item-status2 {
      color: black;
    }
    
    #tl-auction {
      font-size: 1.3em;
      text-align: center;
    }
    
    .timeline {
      list-style: none;
      padding: 20px 0 20px;
      position: relative;
    }
    
    .btn-labels {
      font-size: 1.2em;
      margin: 2px 2px 2px 2px;
      white-space: nowrap;
      text-align: center;
    }
    
    .guest-auction {
      font-size: 1.2em;
      margin: 2px 2px 2px 2px;
      white-space: nowrap;
      text-align: center;
    }
    
    .dropdown-menu {
      left: 50% !important;
      margin-left: -70px;
    }
    
    #accordion {
      text-align: center;
    }
    
    .timeline-heading {
      margin: 6px;
    }
    
    .progress {
      height: 12px;
      margin-bottom: 0;
    }
    
    .carousel {
      margin-top: 20px;
      height: 100%;
      max-height: 64px;
    }
    
    .carousel .item img {
      margin: 0 auto;
      /* Align slide image horizontally center */
      height: 100%;
      max-height: 60px;
      width: auto;
    }
    
    .carousel-indicators li {
      display: none;
    }
    
    .carousel-caption {
      padding: 0 0 0 6px;
      text-align: left;
      /* bottom: auto; */
      color: #000;
      font-size: 1.0em;
      -webkit-font-smoothing: antialiased;
    }
    
    @media screen and (min-width: 1024px) {
      .itemtext {
        height: 150px;
      }
    }
    
    @media screen and (max-width: 800px) {
      .itemtext {
        height: 100px;
      }
    }
    
    @media screen and (max-width: 600px) {
      .itemtext {
        height: 60px;
      }
    }
  </style>


</head>

<body>

  <div id="cn-auction" class="container">

    <div class="guest-auction">
      <div class="dropdown">
        <a id="tl-alarm-btn" type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="" data-target="">
          <span class="glyphicon glyphicon-bell" data-toggle="tooltip" title="Activity on your items and chats"></span>
        </a>
        <button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <span id="guest-name"></span>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li><a href="#">Settings</a></li>
          <li><a href="#">Checkout</a></li>
          <li><a href="/auction/login.html">Log off</a></li>
          <!-- <li role="separator" class="divider"></li> -->
        </ul>
        <a id="tl-cart-btn" type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="" data-target="">
          <span class="glyphicon glyphicon-shopping-cart" data-toggle="tooltip" title="View your cart"></span>
        </a>
      </div>

    </div>

    <div class="btn-labels">
      <!-- <span class="label label-danger">alice</span>
        <span class="label label-primary">story</span>
        <span class="label label-warning">Favorites</span>  -->
      <span class="label label-info">Auction</span>
      <span class="label label-success">Watched</span>
      <span class="label label-default">Chat Rooms</span>
      <span class="label label-primary">Help</span>
    </div>
    <div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
      <!-- Carousel indicators -->
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
      </ol>
      <!-- Wrapper for carousel items -->
      <div class="carousel-inner">
        <div class="item active">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/home.png" alt="First Slide">
          <div class="carousel-caption">
            Household
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/men.png" alt="Third Slide">
          <div class="carousel-caption">
            Men
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/ladies.png" alt="Second Slide">
          <div class="carousel-caption">
            Ladies
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/wine.png" alt="Third Slide">
          <div class="carousel-caption">
            Wine &amp; Spirits
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/pets.png" alt="Third Slide">
          <div class="carousel-caption">
            Animals
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/electronics.png" alt="Third Slide">
          <div class="carousel-caption">
            Electronics
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/children.png" alt="Third Slide">
          <div class="carousel-caption">
            Children
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/sports.png" alt="Third Slide">
          <div class="carousel-caption">
            Sports
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/famous.png" alt="Third Slide">
          <div class="carousel-caption">
            Famous
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/gift.png" alt="Third Slide">
          <div class="carousel-caption">
            Gift Cards
          </div>
        </div>
        <div class="item">
          <img src="https://s3.amazonaws.com/potofcoffee2go/byatec/images/painting.png" alt="Third Slide">
          <div class="carousel-caption">
            Paintings
          </div>
        </div>
      </div>
      <!-- Carousel controls -->
      <a id="carousel-control-left" class="carousel-control left" href="#myCarousel" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
      </a>
      <a id="carousel-control-right" class="carousel-control right" href="#myCarousel" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
      </a>
    </div>
    <div class="timeline-panel">
      <div class="timeline-body">
        <p id="tl-body"></p>
      </div>


      <div class="timeline-heading collapse">
        <!-- <h4 class="timeline-title itemtext">Search: </h4> -->
        <div class="text-center">
          <span class="pull-left">Search Items... </span> Found: 0
          <label class="tl-checkbox btn pull-right"><input type="checkbox" autocomplete="off" />This category</label>
        </div>
        <p></p>
        <div class="input-group">
          <input id="btn-search-input" type="text" class="form-control input-sm" placeholder="Your search text..." />
          <span class="input-group-btn">
                    <button id="btn-send" class="btn btn-warning btn-sm">
                      Search
                    </button>
                </span>
        </div>
      </div>
      <p> </p>
      <div class="timeline-footer">
        <div class="panel panel-primary">
          <div class="progress">
            <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%;">
              <span class="sr-only">60% Complete</span>
            </div>
          </div>

          <div class="panel-heading" id="accordion">
            <div class="pull-left">
              <a id="item-left-btn" type="button" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-arrow-left" data-toggle="tooltip" title="Previous item in this category"></span>
              </a>
              &nbsp;
              <a id="tl-chat-btn" type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="#accordion" data-target="#collapseChat">
                <span class="glyphicon glyphicon-comment" data-toggle="tooltip" title="Comment about this item"></span>
              </a>
            </div>
            <span id="tl-item-count">&nbsp;</span>
            <div class="pull-right">
              <a id="tl-search-btn" type="button" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-search" data-toggle="tooltip" title="Search for items"></span>
              </a>
              &nbsp;
              <a id="item-right-btn" type="button" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-arrow-right" data-toggle="tooltip" title="Next Item in this category"></span>
              </a>
            </div>
          </div>
          <div class="panel-collapse collapse" id="collapseBid">
            <div class="panel-body">
              <p id="tl-bid-item-desc"><b>Bid on this item</b></p>
              <div class="panel-footer">
                <span id="tl-auction" style="font-size: 16px;"></span>
                <h4><span id="tl-buy-now" class="label label-success pull-right" style="color: #F5F5F5; height: 30px; text-align: center; vertical-align: middle; line-height: 24px;">Buy Now for $</span></h4>
                <div class="input-group">
                  <input id="btn-bid-input" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                  <span class="input-group-btn">
                                <button id="btn-bid" class="btn btn-success btn-sm" style="margin-right: 24px;">
                                  Bid&nbsp;
                                </button>
                            </span>
                </div>
              </div>
              <ul class="chat">
                <li class="left clearfix">
                  <span class="chat-img pull-left">
                                <img src="https://placehold.it/32/55C1E7/fff&text=JS" alt="User Avatar" class="img-circle" />
                              </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <strong class="primary-font">Jack Sparrow</strong> <small class="pull-right text-muted">
                                          <span class="glyphicon glyphicon-time"></span>12 mins ago</small>
                    </div>
                    <p>
                      Bid: <b>$125</b>
                    </p>
                  </div>
                </li>
                <li class="right clearfix">
                  <span class="chat-img pull-right">
                              <img src="https://placehold.it/32/FA6F57/fff&text=JB" alt="User Avatar" class="img-circle" />
                          </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <small class=" text-muted"><span class="glyphicon glyphicon-time"></span>13 mins ago</small>
                      <strong class="pull-right primary-font">James Bond</strong>
                    </div>
                    <p>
                      Your Bid: <b>$100</b>
                    </p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="panel-collapse collapse" id="collapseChat">

            <span id="tl-item-status1">&nbsp;</span><span id="tl-item-status2">&nbsp;</span>

            <div class="panel-body">
              <p id="tl-chat-item-desc"><b>Comment on this item</b></p>
              <div class="panel-footer">
                <div class="input-group">
                  <input id="btn-chat-input" type="text" class="form-control input-sm" placeholder="Type your message here..." value="" />
                  <span class="input-group-btn">
                                <button id="btn-send" class="btn btn-warning btn-sm">
                                  Send
                                </button>
                            </span>
                </div>
              </div>
              <ul class="chat">
                <li class="left clearfix">
                  <span class="chat-img pull-left">
                              <img src="https://placehold.it/50/55C1E7/fff&text=JS" alt="User Avatar" class="img-circle" />
                            </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <strong class="primary-font">Jack Sparrow</strong> <small class="pull-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>12 mins ago</small>
                    </div>
                    <p>
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare dolor, quis ullamcorper ligula sodales.
                    </p>
                  </div>
                </li>
                <li class="right clearfix">
                  <span class="chat-img pull-right">
                              <img src="https://placehold.it/50/FA6F57/fff&text=JB" alt="User Avatar" class="img-circle" />
                          </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <small class=" text-muted">
                                        <span class="glyphicon glyphicon-time"></span>13 mins ago
                                      </small>
                      <strong class="pull-right primary-font">James Bond</strong>
                    </div>
                    <p>
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare dolor, quis ullamcorper ligula sodales.
                    </p>
                  </div>
                </li>
                <li class="left clearfix">
                  <span class="chat-img pull-left">
                              <img src="https://placehold.it/50/55C1E7/fff&text=HS" alt="User Avatar" class="img-circle" />
                          </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <strong class="primary-font">Hans Solo</strong>
                      <small class="pull-right text-muted">
                                          <span class="glyphicon glyphicon-time"></span>14 mins ago
                                      </small>
                    </div>
                    <p>
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare dolor, quis ullamcorper ligula sodales.
                    </p>
                  </div>
                </li>
                <li class="right clearfix">
                  <span class="chat-img pull-right">
                              <img src="https://placehold.it/50/FA6F57/fff&text=JB" alt="User Avatar" class="img-circle" />
                          </span>
                  <div class="chat-body clearfix">
                    <div class="header">
                      <small class=" text-muted">
                                        <span class="glyphicon glyphicon-time"></span>
                                        15 mins ago
                                        </small>
                      <strong class="pull-right primary-font">James Bond</strong>
                    </div>
                    <p>
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare dolor, quis ullamcorper ligula sodales.
                    </p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <hr>
    </div>
  </div>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

  <!-- Bootstrap Core JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- Sockets JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>

  <!-- Byatec Auction JavaScript -->
  <script src="../js/byatec.js"></script>

  <!-- Touchswipe carousel JavaScript -->
  <script src="touchswipe.js"></script>

  <script>
    /* global $ byatec localStorage */

    var guests = {},
      curGuest = {},
      cats = {},
      catIds = [],
      curCatIdx = 0,
      items = {},
      itemIds = [],
      curItemIdx = 0,
      pbloaded = 0, // loaded part
      pbPct = 100;

    $('#item-left-btn').click(function() {
      if (curItemIdx === 0) curItemIdx = itemIds.length;
      $('#tl-item-count').html('-&nbsp;' + curItemIdx + '&nbsp;-');
      pbPct = parseInt((curItemIdx / itemIds.length) * 100);
      $('.progress-bar').attr('aria-valuenow', +(curItemIdx + 2)).attr('style', 'width:' + pbPct + '%');
      displayItem(itemIds[--curItemIdx]);
    });

    $('#item-right-btn').click(function() {
      if (curItemIdx === itemIds.length - 1) curItemIdx = -1;
      $('#tl-item-count').html('-&nbsp;' + (curItemIdx + 2) + '&nbsp;-');
      pbPct = parseInt(((curItemIdx + 2) / itemIds.length) * 100);
      $('.progress-bar').attr('aria-valuenow', +(curItemIdx + 2)).attr('style', 'width:' + pbPct + '%');
      displayItem(itemIds[++curItemIdx]);
    });

    $('#tl-search-btn').click(function() {
      if ($('.timeline-heading').hasClass('in')) {
        $('.timeline-heading').collapse('hide');
      }
      else {
        $('.timeline-heading').collapse('show');
      }
    });

    $('#tl-chat-btn').click(function() {
      if ($('#collapseChat').hasClass('in')) {
        $('#collapseBid').collapse('show');
      }
      else {
        $('#collapseBid').collapse('hide');
      }
      // $('#collapseBid').hasClass('in');//Will return true if uncollapsed
      // $('#collapseBid').hasClass('collapsing');//Will return true if in the process of collapsing
      // $('#collapseBid').hasClass('collapse');//Will return true if collapsed
    });

    $('#tl-bid-btn').click(function() {
      $('#collapseChat').collapse('hide');
    });

    // Enable Carousel Controls
    $('#carousel-control-left').click(function() {
      curCatIdx--;
      if (curCatIdx < 0) curCatIdx = catIds.length - 1;
      displayCategories(catIds[curCatIdx]);
    });
    $('#carousel-control-right').click(function() {
      curCatIdx++;
      if (curCatIdx >= catIds.length) curCatIdx = 0;
      displayCategories(catIds[curCatIdx]);
    });



    function displayItem(id) {
      console.log('ITEM', items[id]);

      $('.timeline-title').html(id + ' - ' + items[id].profile.Item);
      // $('#tl-body').html('');
      //$('#tl-date').html(' ' + item.status.timestamp.split('T')[1].split('+')[0]);
      $('#tl-auction').html('Next bid is at $<b>' + items[id].auction.NextBid + '</b> or better');
      $('#tl-buy-now').html('Buy now for $' + items[id].auction.BuyPrice);
      $('#btn-bid-input').val(items[id].auction.NextBid);

      $('#tl-item-status1').html(items[id].auction.Active ? ' Active ' : ' ! Suspended ! ');
      $('#tl-item-status2').html(' at $' + items[id].auction.NextBid);

      $('#tl-bid-item-desc').fadeOut('fast', function() {
        $('#tl-bid-item-desc').html('<span style="font-size: 18px;"><b>' + id + ' - ' + items[id].profile.Item + '</b></span>');
        $('#tl-bid-item-desc').fadeIn('fast');
      });

      $('#tl-chat-item-desc').html('<b>' + items[id].profile.Item + '</b>');

    }

    function displayCategories(id) {
      // Change of category carousel
      items = cats[id].items;
      itemIds = Object.keys(cats[id].items);
      curItemIdx = 0;
      $('#tl-item-count').html('-&nbsp;1&nbsp;-');
      $('.progress-bar').attr('aria-valuenow', '1');
      $('.progress-bar').attr('aria-valuemax', +itemIds.length);
      pbPct = parseInt((1 / itemIds.length) * 100);
      $('.progress-bar').attr('aria-valuenow', +(curItemIdx + 2)).attr('style', 'width:' + pbPct + '%');
      displayItem(itemIds[curItemIdx]);
    }

    function findItemInCat(id) {

    }

    /*  Socket Event Handlers   */
    byatec.connect("https://byatc-potofcoffee2go.c9users.io");
    // byatec.connect("https://byatc-potofcoffee2go.rhcloud.com");

    byatec.on('Connected', function(msg) {
      console.log('onConnected', msg);
      byatec.watch('/cyborg/chef/guests/' + localStorage.getItem('BYATEC_GUEST'));
      byatec.watch('/cyborg/chef/items/by/category');
      // byatec.watch("/cyborg/chef/categories");
    });

    byatec.on('Restful', function(msg) {
      var path = msg.resource.split('/');
      if (path[3] === 'items') {
        var inItemId = Object.keys(msg.data)[0];
        var catItem = findItemInCat(inItemId);
        catItem = msg.data[inItemId];
      }
    });

    byatec.on('Watch', function(msg) {
      var path = msg.resource.split('/');
      if (path[3] === 'guests') {
        console.log(msg.data[path[4]]);
        curGuest = msg.data[path[4]];
        $('#guest-name').html('<b>' + curGuest.checkout.Name + '</b>');
      }
      else if (path[3] === 'items') {
        cats = msg.data;
        catIds = Object.keys(cats);
        curCatIdx = 0;
        displayCategories(catIds[curCatIdx]);
      }
      console.log('onWatch', msg);
    });

    $(document).ready(function() {
      $('#modal-logon').load('loginform.html');
      $('[data-toggle="tooltip"]').tooltip({
        delay: {
          show: 2500,
          hide: 100
        }
      });
      $('#collapseBid').collapse('show');

      //Enable swiping...
      $(".carousel-inner").swipe({
        //Generic swipe handler for all directions
        swipeLeft: function(event, direction, distance, duration, fingerCount) {
          $(this).parent().carousel('next');
          curCatIdx++;
          if (curCatIdx >= catIds.length) curCatIdx = 0;
          displayCategories(catIds[curCatIdx]);
        },
        swipeRight: function() {
          $(this).parent().carousel('prev');
          curCatIdx--;
          if (curCatIdx < 0) curCatIdx = catIds.length - 1;
          displayCategories(catIds[curCatIdx]);
        },
        //Default is 75px, set to 0 for demo so any distance triggers swipe
        threshold: 0
      });
    });
  </script>

</body>

</html>
